import{_ as e,o,c as r,a,b as p,d as n,e as l,r as i}from"./app-CNRroVhM.js";const g="/assets/1-C5eIU_id.png",c="/assets/2-kUZaW2_7.png",d="/assets/3-C5o9xdxO.png",b="/assets/4-CvN9dIWi.png",m="/assets/5-G9qPSJTT.png",h="/assets/6-DJE1w5EX.png",_="/assets/7-BvvNcVIo.png",f="/assets/8-yxUHTSJE.png",u="/assets/9-DDsyDECE.png",v="/assets/10-BSc2gy5v.png",A="/assets/12-BSzBqN_q.png",x="/assets/13-6llYzDdZ.png",T="/assets/14-DC9Vkck8.png",M="/assets/15-CFFYppkd.png",k="/assets/16-BdoMrVfJ.png",S="/assets/17-BAeIsooJ.png",y="/assets/18-P5Rby30x.png",C="/assets/19-DNqSKIua.png",D="/assets/20-DAPYpyU0.png",F={},E={href:"https://blog.csdn.net/louyangyang91/article/details/125374324",target:"_blank",rel:"noopener noreferrer"};function N(O,s){const t=i("ExternalLinkIcon");return o(),r("div",null,[s[4]||(s[4]=a(`<h2 id="蓝牙ota升级学习记录" tabindex="-1"><a class="header-anchor" href="#蓝牙ota升级学习记录"><span><strong>蓝牙OTA升级学习记录</strong></span></a></h2><p><strong>直接介绍怎么用蓝牙ota，具体原理请查看https://github.com/xbf0/ota_bluetooth/tree/main</strong></p><h4 id="一-用到的" tabindex="-1"><a class="header-anchor" href="#一-用到的"><span><strong>一 .用到的</strong></span></a></h4><p><em><strong>1.硬件</strong></em></p><p>蓝牙模块<strong>hc-05</strong>，<strong>stm32f102zet6</strong>开发板（正点原子）</p><p><strong>2.软件</strong></p><p><strong>python文件</strong>，<strong>hc-05固件</strong>（出厂自带），stm32程序</p><h2 id="二-操作" tabindex="-1"><a class="header-anchor" href="#二-操作"><span><strong>二.操作</strong></span></a></h2><p><strong>1.配置蓝牙透传</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">AT+ORGL            // 恢复出厂设置（可选）</span>
<span class="line"></span>
<span class="line">AT+NAME<span class="token operator">=</span>YModemBT     // 设置模块名称</span>
<span class="line"></span>
<span class="line">AT+UART<span class="token operator">=</span><span class="token number">115200,0</span>,0 // 设置波特率115200</span>
<span class="line"></span>
<span class="line">AT+CMODE<span class="token operator">=</span><span class="token number">1</span>         // 允许连接任意地址 </span>
<span class="line"></span>
<span class="line">AT+ROLE<span class="token operator">=</span><span class="token number">0</span>          // 设为从机模式 </span>
<span class="line"></span>
<span class="line">AT+PSWD<span class="token operator">=</span><span class="token number">1234</span>       // 设置配对密码（默认1234） </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2-stm32程序" tabindex="-1"><a class="header-anchor" href="#_2-stm32程序"><span><strong>2.stm32程序</strong></span></a></h5><p>ota升级要用到两个程序烧写到flash的不同分段上，分别为bootloader和app程序。</p><p>正常状态运行app程序，当收到新的app程序时，运行bootloader进行升级。</p><p>新的app程序通过bin文件的形式通过蓝牙传给stm32</p><h5 id="_2-1获取app-bin文件" tabindex="-1"><a class="header-anchor" href="#_2-1获取app-bin文件"><span><strong>2.1获取app.bin文件</strong></span></a></h5><p>打开STM32F103rb_App1的keil工程文件，点击魔术棒，如下图，进入这个user界面，选中图中红框位置的Run #1</p><p><img src="`+g+'" alt="f60a6104acda6763794808ff5396b525"></p><p>然后点击第二个红框的文件夹图标</p><p>图中的配置是<code>D:\\MDK5.36\\ARM\\ARMCC\\bin\\fromelf.exe --bin --output STM32F103rb_App1\\STM32F103rb_App1.bin STM32F103rb_App1\\STM32F103rb_App1.axf</code></p><p>1.首先是fromolf.exe路径，在MDK的文件夹里面，MDK5.36-&gt;ARM-&gt;ARMCC-&gt;bin-&gt;fromelf.exe</p><p>2.路径后面是固定的 <code>--bin --output</code> ，注意空格</p><p>3.最后是STM32F103rb_App1\\STM32F103rb_App1.bin STM32F103rb_App1\\STM32F103rb_App1.axf</p><p>这个STM32F103rb_App1是魔术棒里output界面的名称，注意两个文件路径中间有一个空格隔开（相对路径）</p><p><img src="'+c+'" alt="d67ab817f862b08d51d126ba0584ebf1"></p><p>配置好之后编译，输出中有红框信息说明生成bin文件成功,或者直接到STM32F103rb_App1\\STM32F103rb_App1.bin 这个相对路径下查看</p><p><img src="'+d+'" alt="6921b60643532df675652f447be9bb1e"></p><p><img src="'+b+'" alt="221147756cbdce549d5e85d71a51151f"></p><p><strong>2.2设置代码烧写地址</strong></p><p>stm32程序地址从0x8000000开始，前面放bootloader,后面放app</p><p><strong>2.2.1设置bootloader地址</strong></p><p>打开bootloader程序，打开魔术棒target页面，start不变，<strong>把size值调小</strong>，size的大小需要可以容纳bootloader程序，另外注意不能刚刚好，因为stm32f103zet6的flash程序擦除是按页擦除的，也就是说bootloader程序的尾地址不能和app程序的首地址在同一页，所以这个地址最好是某一页的首地址。页就是一个地址块，里面是连续的地址。</p><p><img src="'+m+'" alt="b744250096f5b16dac663c7cd21717e9"></p><p><strong>2.2.2设置app地址</strong></p><p>同样打开app的target界面</p><p><strong>app的start</strong>是<strong>bootloader的start</strong> + <strong>bootloader的size</strong></p><p>app的size同样也不能设置的太大，因为还要预留空间用来接收bin文件</p><p><img src="'+h+'" alt="e8b86fb1e0f6f51c34e26239834a2096"></p><h4 id="_3-flash图示" tabindex="-1"><a class="header-anchor" href="#_3-flash图示"><span><strong>3.flash图示</strong></span></a></h4><p>到这里已经设置好了 flash地址分区，下图是flash分区示意图.</p><p><img src="'+_+'" alt="image-20250307204609054"></p><p>app1是运行区，app2是备份区，app2的最后一位地址是标志位，这个标志位在接受bin文件完成后和更新app完成后会发生变化，app程序和bootloader都可以读取到。</p><p><strong>4.下载程序</strong></p><p><img src="'+f+'" alt="image-20250307200117316"></p><h2 id="app的下载" tabindex="-1"><a class="header-anchor" href="#app的下载"><span><strong>APP的下载</strong></span></a></h2><p><img src="'+u+'" alt="74d806b995da138ee17d2f06fb5454f9"></p><p><strong>开始下载烧录bootloader,然后烧录app，查看串口输出</strong></p><p>修改app的main.c中的版本号，再次下载，看到串口输出的版本号有变化，说明可以成功下载并跳转到app.</p><p><img src="'+v+'" alt="image-20250307200610221"></p><p>以上是用单片机的debug口下载的，后面就可以通过各种方式更新app，如串口，wifi，蓝牙等，传输协议是ymodem串口协议。</p><p>因为之前已经设置过hc-05为透传模式，所以相当于电脑和单片机之间有一个无线的串口</p><h3 id="_5-python程序" tabindex="-1"><a class="header-anchor" href="#_5-python程序"><span><strong>5.python程序</strong></span></a></h3><p>下面就到最后一步，修改python的参数</p><p>我用的是pycharm</p><p><strong>安装依赖，在终端运行</strong></p><p><code>pip install pyserial</code></p><p><img src="'+A+'" alt="12a46a3759fc3cd076589b7239a53859"></p><p>需要修改下面两块，一个是com口，一个是路径</p><p><img src="'+x+'" alt="9ebe65a6b525149076ba84191a3ca7e0"></p><p><strong>5.1.路径</strong></p><p>可以用<strong>相对路径</strong>或者<strong>绝对路径</strong>，绝对路径就是右键bin文件，然后复制文件地址</p>',60)),p("p",null,[s[1]||(s[1]=p("strong",null,"5.2.COM",-1)),s[2]||(s[2]=n("，（参考：")),p("a",E,[s[0]||(s[0]=n("PC蓝牙加串口调试助手调试蓝牙设备_电脑蓝牙调试助手-CSDN博客")),l(t)]),s[3]||(s[3]=n("）"))]),s[5]||(s[5]=a('<p><strong>5.2.1.右键蓝牙，转到设置</strong></p><p><img src="'+T+'" alt="image-20250307201833287"></p><p><strong>5.2.2.点击设备</strong></p><p><img src="'+M+'" alt="d80c1546778852402b36195beff271f4"></p><p><strong>5.2.3下滑到相关设置点击 <em>更多蓝牙设置</em></strong></p><p><img src="'+k+'" alt="5d115df926e7313113def0158a9608b8"></p><p><strong>5.2.4添加COM 点击添加后会加载一小会</strong></p><p><img src="'+S+'" alt="4049eb3fc8c89036fd12938c5a0d76be"></p><p><strong>5.2.5选中传出，点击浏览，选择设备，确定</strong></p><p><img src="'+y+'" alt="f2b1d0ccb78cbe983474d73e7c40276b"></p><p><strong>5.2.6查看COM口 更换参数</strong></p><p><img src="'+C+'" alt="5de22c37fa602003abc304a7cdc2a030"></p><p><strong>然后点击运行，注意确保hc-05上电，并且vcc接5v,gnd，tx，rx都与单片机连接正常</strong></p><p><img src="'+D+'" alt="9e11f9126ece7151ed8250521e26b85f"></p><p><strong>运行之后，观察串口输出</strong></p><h2 id="结语" tabindex="-1"><a class="header-anchor" href="#结语"><span><strong>结语</strong></span></a></h2><p>这只是怎么使用蓝牙ota，具体原理请查看STM32CubeMx_OTA文件夹，遇到问题联系：QQ:488763619</p><p>程序在128k，并且按页擦除的flash没问题，其他类型的单片机需要修改bootloader和 app1，app2的地址，还有标志位，我还没有在其它类型的单片机复现过，后面我应该会再写一个更详细的包含具体过程的笔记</p>',18))])}const P=e(F,[["render",N],["__file","blue_t_ota.html.vue"]]),R=JSON.parse('{"path":"/blogs/danpianji/blue_t_ota.html","title":"蓝牙无线升级","lang":"en-US","frontmatter":{"title":"蓝牙无线升级","date":"2025-03-06T00:00:00.000Z","tags":["ota"],"categories":["单片机通信"]},"headers":[{"level":2,"title":"蓝牙OTA升级学习记录","slug":"蓝牙ota升级学习记录","link":"#蓝牙ota升级学习记录","children":[]},{"level":2,"title":"二.操作","slug":"二-操作","link":"#二-操作","children":[]},{"level":2,"title":"APP的下载","slug":"app的下载","link":"#app的下载","children":[{"level":3,"title":"5.python程序","slug":"_5-python程序","link":"#_5-python程序","children":[]}]},{"level":2,"title":"结语","slug":"结语","link":"#结语","children":[]}],"git":{},"filePathRelative":"blogs/单片机/blue_t_ota.md"}');export{P as comp,R as data};
